<project name="Build All Elements" default="call.antRunner">

	<property name="scriptdir" location="."/>
	<property file="${scriptdir}/build.general.properties" />
	<property file="${projectPropertiesFile}" />
	
	<!-- target calls the eclipse antRunner processing THIS build file on target 'main' -->
	<target name="call.antRunner">
		<property name="jobdir" location="../../../${job}/workspace" />
		<property name="projectPropertiesFile" location="${jobdir}${projectProperties}" />
		
	    <echo message="${jobdir}"/>
		<echo message="${baseLocation}"/>
		<echo message="${baseLocation}/plugins/org.eclipse.equinox.launcher_${equinoxLauncherPluginVersion}.jar" />
		<echo message="PropertiesFile: ${projectProperties} ${projectPropertiesFile}"/>

		<!-- property name="workspace" value="/var/lib/tomcat5.5/webapps/hudson/jobs/ImportBuildFiles/workspace/eclipseWorkspace"/ -->
		<property name="workspace" value="${jobdir}/eclipseWorkspace"/>
		<java classname="org.eclipse.equinox.launcher.Main" fork="true" failonerror="true">
			<arg value="-configuration" />
			<arg value="/var/lib/tomcat5.5/webapps/hudson/jobs/ImportBuildFiles/workspace/.eclipse" />
			<arg value="-data" />
			<arg value="${workspace}" />
			<arg value="-clean" />
			<arg value="-consoleLog" />
			<arg value="-application" />
			<arg value="org.eclipse.ant.core.antRunner" />
			<arg value="-buildfile" />
			<arg value="${scriptdir}/build.feature.xml" />
			<arg value="genEMFcode" />
			<arg value="genGMFcode" />
			<arg value="build" />
			<arg value="-Dbasedir=${jobdir}" />
			<arg value="-Dscriptdir=${scriptdir}" />
			<arg value="-DprojectPropertiesFile=${projectPropertiesFile}" />
			<arg value="-DpluginPath=${pluginPath}" />
			<arg value="-DtopLevelElementType=feature" />
			<arg value="-DtopLevelElementId=${part}" />
			
			<classpath>
				<pathelement location="${baseLocation}/plugins/org.eclipse.equinox.launcher_${equinoxLauncherPluginVersion}.jar" />
			</classpath>
		</java>
		<antcall target="rmEclipseWorkspace"/>
	</target>

	<target name="build">
		<echo message="BaseDir ${basedir}"/>
		<echo message="ScriptDir ${scriptdir}"/>
		<echo message="BuildDir ${buildDirectory}"/>
		<echo message="PluginPath ${pluginPath}"/>
		<echo message="GenModel ${genModel}"/>
		
		<mkdir dir="${buildDirectory}/update-site/features" />
		<mkdir dir="${buildDirectory}/update-site/plugins" />
		<ant antfile="${baseLocation}/plugins/org.eclipse.pde.build_${pdeBuildPluginVersion}/scripts/build.xml">
			<target name="generate"/>
		</ant>
		<ant antfile="build.xml" dir="${elementPath}">
			<property name="feature.destination" value="${buildDirectory}/update-site/features"/>
			<property name="plugin.destination" value="${buildDirectory}/update-site/plugins"/>
			<target name="build.jars"/>
			<target name="build.update.jar"/>
		</ant>
	</target>
	
	<target name="genEMFcode" if="genModel">
		<kieler.genEMFcode genModel="${genModel}"
						   genModelCode="${genModelCode}" genEditCode="${genEditCode}" genEditorCode="${genEditorCode}" genTestsCode="${genTestsCode}" />
		<move todir="${buildDirectory}/plugins">
		    <fileset dir="${buildDirectory}/eclipseWorkspace/"/>
		</move>
	</target>

	<target name="genGMFcode" if="gmfgenModel">
		<kieler.genGMFdiagramCode gmfgenModel="${gmfgenModel}"/>
		<move todir="${buildDirectory}/plugins">
		    <fileset dir="${buildDirectory}/eclipseWorkspace/"/>
		</move>
	</target>
	
	<target name="rmEclipseWorkspace">
		<delete dir="${buildDirectory}/eclipseWorkspace"/>
	</target>

	
<!--	      <mkdir dir="${buildDirectory}/update-site"/>
	      <mkdir dir="${buildDirectory}/update-site/features"/>
	      <copy todir="${buildDirectory}/update-site/features">
		  <fileset dir="${buildDirectory}/features">
		      <include name="*.jar"/>
		  </fileset>
	      </copy>
	      <mkdir dir="${buildDirectory}/update-site/plugins"/>
	      <copy todir="${buildDirectory}/update-site/plugins">
		  <fileset dir="${buildDirectory}/plugins">
		      <include name="*.jar"/>
		  </fileset>
	      </copy>
-->
	
</project>
