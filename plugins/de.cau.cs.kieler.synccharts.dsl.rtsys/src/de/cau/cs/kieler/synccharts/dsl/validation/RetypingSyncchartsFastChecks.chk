/*
 * specify inexpensive constraints for the derived metamodels 
 * executed when ... 
 *   1. the user opens a file  
 *   2. whenever the user changes its content
 *   3. also at generation time
 */
import retypingSynccharts;

//===================================================================================================================//
                                                //*** CHECK : State_1 ***//
// there must be at least one initial state
context State ERROR
	"Your syncchart is not deterministic due to the lack of an initial state. Please define at least one initial state!"
:
	eAllContents.typeSelect(State).exists(e|e.isInitial)
;
//===================================================================================================================//
                                                //*** CHECK : State_2 ***//
// if state ID skipped but state label exists then set the ID to the label
// TODO: check if the state ID is unique    
context State WARNING 
	"I have set the state ID " + this.stateID + " to the state label: " + this.stateLabel 
:
	(this.stateID == null || this.stateID.length==0) && this.stateLabel != null ? (this.setStateID(this.stateLabel) -> false) : true
;
// entgegengesetzter Fall
//context State WARNING 
//	"My ID is: " + this.stateID + " and my label is: " + this.stateLabel 
//:
//	(this.stateID == null || this.stateID.length==0) && this.stateLabel != null ? true : false
//;
//===================================================================================================================//
                                                //*** CHECK : State_3 ***//
// only textual states have body texts:
context State ERROR
	"Only textual states have body texts. Please remove the body text from your non-textual state."
:
	!((this.stateKind != StateType::TEXTUAL) && (this.bodyText != null))
;
//===================================================================================================================//
                                                //*** CHECK : State_4 ***//
// textual states have only body texts:
context State ERROR
	"Textual states cannot have any state contents. Please remove anything but the body text from your textual state. 
	You might as well change your state type to something non-textual and remove the body text :)"
:
	!((this.stateKind == StateType::TEXTUAL) && (this.stateContent != null))
;
//===================================================================================================================//
                                                //*** CHECK : StateContent_1 ***//
// referenced states can only be of type "reference"
context StateContent ERROR
	"A referenced state can only be of type reference"
:
	//(this.referencedState.stateKind == StateType::REFERENCE)
	true
;
//===================================================================================================================//
//===================================================================================================================//
                                                //*** CHECK : Signal_1 ***//
// combine operator should be associative and commutative

//===================================================================================================================//
                                                //*** CHECK : Signal_2 ***//
// If the combineOperator is set to CombineOperator::HOST, the user has to define a hostCombineOperator
context Signal WARNING 
	"My combineOperator is set to CombineOperator::HOST but you have not defined a hostCombineOperator thus I do not know which operator to take! 
	Please either define a hostCombineOperator or set the combineOperator to something else than CombineOperator::HOST "
: 
	!((this.combineOperator == CombineOperator::HOST) && (this.hostCombineOperator == null))
;
//===================================================================================================================//
//===================================================================================================================//
                                                //*** CHECK : Signal_3 ***//
// it does not make much sense to define a hostCombineOperator if the combineOperator is not set to CombineOperator::HOST
context Signal WARNING 
	"You have defined a hostCombineOperator"
: 
	true
;
//===================================================================================================================//




























